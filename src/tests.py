from torch import tensor
import unittest
import numpy as np

from utils import get_regions

example = {'input_ids': tensor([ 2, 15, 21,  8, 21,  9, 13, 20, 15,  9, 13, 22, 11, 14,  9, 21,  3, 15,
              9,  8, 15, 17, 10, 19,  9, 13,  3, 14, 21, 21, 14, 16,  5,  8, 21, 14,
              8,  9,  8, 21, 14, 20,  3, 28, 12, 23, 14, 28, 21,  9, 13, 22, 23, 17,
            23, 28,  9, 17, 13,  5, 28, 26, 21, 28, 17, 15, 28, 23, 26,  5,  9, 15,
              5, 28, 15, 26, 28,  3]),
      'token_type_ids': tensor([2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2,
              2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0,
              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
              0, 0, 0, 0, 0, 0]),
      'position_ids': tensor([  0,  15,  14,  13,  12,  11,  10,   9,   8,   7,   6,   5,   4,   3,
                2,   1,   0,   1,   2,   3,   4,   5,   6,   7,   8,   9,   0,   1,
                2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,
                0,   7,   9,  24,  45,  59,  62,  63,  66,  67,  69,  70,  73,  74,
                76,  77,  80,  81,  84,  95,  97,  99, 114, 116, 118, 143, 147, 150,
              152, 156, 158, 159, 163, 167, 171,   0]),
      'input_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1]),
      'targets': tensor([1.])}

example_array = np.array([np.array([ 2, 20, 19, 15, 20, 15, 15, 19, 14, 23, 11, 25, 22, 20, 15, 22,  3,
              23,  5, 15, 14, 25,  5, 22, 23, 21,  3, 15, 15, 20, 13, 15,  5, 13,
              23, 23, 11, 23, 28,  5,  8, 14,  3, 28, 23,  5, 16, 28, 21, 17, 17,
              25,  5, 12, 13,  8, 25,  8, 23, 15, 28, 13, 16, 28, 20,  8, 28, 23,
              26,  5, 25, 15,  5, 28, 23, 26, 12,  3], dtype=np.int64)              ,
       np.array([2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2,
              2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0,
              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], dtype=np.int64)                ,
       np.array([  0,  15,  14,  13,  12,  11,  10,   9,   8,   7,   6,   5,   4,
                3,   2,   1,   0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
                0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,
               13,  14,  15,   0,   7,   9,  24,  45,  59,  62,  63,  66,  67,
               69,  70,  73,  74,  76,  77,  80,  81,  84,  95,  97,  99, 114,
              116, 118, 143, 147, 150, 152, 156, 158, 159, 163, 167, 171,   0],
             dtype=np.int64)                                                      ,
       np.array([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], dtype=np.int64)                ,
       np.array([1.], dtype=np.float32)], dtype=object)

class TestInstanceManipulations(unittest.TestCase):

    def test_get_regions(self):
        peptide = [23,  5, 15, 14, 25,  5, 22, 23, 21]
        mhc = [23,  5, 16, 28, 21, 17, 17,
              25,  5, 12, 13,  8, 25,  8, 23, 15, 28, 13, 16, 28, 20,  8, 28, 23,
              26,  5, 25, 15,  5, 28, 23, 26, 12,  3]
        print(get_regions(example_array)[0])
        self.assertEqual(get_regions(example_array)[0], peptide)
        self.assertEqual(get_regions(example_array)[0], peptide)

    

if __name__ == '__main__':
    unittest.main()